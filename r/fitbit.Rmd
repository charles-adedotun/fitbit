---
title: "How Can a Wellness Technology Company Play It Smart?"
author: "Adedotun Charles Adegunju"
date: "1/17/2022"
output: html_document
---

# Step 1: Ask
## Business Task
Gaining insights into how people are using smart devices to provide high-level recommendations for how these trends can inform marketing strategy.


# Step 2: Prepare
## Data Source
This dataset generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016. Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. Individual reports can be parsed by export session ID (column A) or timestamp (column B). Variation between output represents use of different types of Fitbit trackers and individual tracking behaviors / preference.
### Acknowlegement
Furberg, Robert; Brinton, Julia; Keating, Michael ; Ortiz, Alexa
https://zenodo.org/record/53894#.YMoUpnVKiP9


# Step 3: Process
## Installing and loading packages and libraries
```{r load packages and libraries, include=FALSE}
library(tidyverse)
library(lubridate)
library(arsenal)
library(ggplot2)
```
## Importing Datasets
```{r read data}
daily_activity <- read.csv("../data/dailyActivity_merged.csv")
daily_calories <- read.csv("../data/dailyCalories_merged.csv")
daily_intensities <- read.csv("../data/dailyIntensities_merged.csv")
daily_steps <- read.csv("../data/dailySteps_merged.csv")
heartrate_seconds <- read.csv("../data/heartrate_seconds_merged.csv")
hourly_calories <- read.csv("../data/hourlyCalories_merged.csv")
hourly_intensities <- read.csv("../data/hourlyIntensities_merged.csv")
hourly_steps <- read.csv("../data/hourlySteps_merged.csv")
minute_calories_narrow <- read.csv("../data/minuteCaloriesNarrow_merged.csv")
minute_calories_wide <- read.csv("../data/minutecaloriesWide_merged.csv")
minute_instensities_narrow <- read.csv("../data/minuteIntensitiesNarrow_merged.csv")
minute_instensities_nwide <- read.csv("../data/MinuteIntensitiesWide_merged.csv")
minute_mets_narrow <- read.csv("../data/minuteMETsNarrow_merged.csv")
minute_sleep <- read.csv("../data/minuteSleep_merged.csv")
minute_steps_narrow <- read.csv("../data/minuteStepsNarrow_merged.csv")
minute_steps_wide <- read.csv("../data/minuteStepsWide_merged.csv")
sleep_day <- read.csv("../data/sleepDay_merged.csv")
weight_log_info <- read.csv("../data/weightLogInfo_merged.csv")
```
## Exploring a few key tables
### Daily Activity
```{r explore daily_activity}
str(daily_activity)
# explore steps, distance and sedentary minutes
daily_activity %>%
  select(TotalSteps, TotalDistance, SedentaryMinutes) %>%
  summary()
# explore number of active minutes per category
daily_activity %>%
  select(VeryActiveMinutes, FairlyActiveMinutes, LightlyActiveMinutes) %>%
  summary()
```
#### Discoveries:
* Average total steps per day are 7638 which a little bit less for having health benefits for according to the CDC research. They found that taking 8,000 steps per day was associated with a 51% lower risk for all-cause mortality (or death from all causes). Taking 12,000 steps per day was associated with a 65% lower risk compared with taking 4,000 steps.

### Sleep Day
```{r explore sleep day}
str(sleep_day)
# explore sleep records, minutes asleep and time in bed
sleep_day %>%
  select(TotalSleepRecords, TotalMinutesAsleep, TotalTimeInBed) %>%
  summary()
```
### Hourly Calories
```{r explore hourly calories}
str(hourly_calories)
```
### Hourly Steps
```{r explore hourly_steps}
str(hourly_steps)
```
### Hourly Intensities
```{r explore hourly_intensities}
str(hourly_intensities)
```
### Daily Steps
```{r explore daily_steps}
str(daily_steps)
```
### Daily Calories
```{r explore daily_calories}
str(daily_calories)
```
### Daily Intensitiues
```{r explore daily_intensities}
str(daily_intensities)
```
### Weight Log Info
```{r explore weight_log_info}
str(weight_log_info)
# explore weight and BMI
weight_log_info %>%
  select(WeightKg, BMI) %>%
  summary()
```

## Data Cleaning & Manipulation
### Hourly Calories
```{r clean hourly_calories}
# convert ActivityHour column into datetime and create new column "ActivityDatime" with result
hourly_calories$ActivityDatetime <- as.POSIXct(hourly_calories$ActivityHour, format="%m/%d/%Y %I:%M:%S %p")
# extract hour from ActivityDatetime and create new column "Hour" with result
hourly_calories$Hour <- format(hourly_calories$ActivityDatetime, format = "%H")
str(hourly_calories)
```
### Hourly Steps
```{r clean hourly_steps}
# convert ActivityHour column into datetime and create new column "ActivityDatime" with result
hourly_steps$ActivityDatetime <- as.POSIXct(hourly_steps$ActivityHour, format="%m/%d/%Y %I:%M:%S %p")
# extract hour from ActivityDatetime and create new column "Hour" with result
hourly_steps$Hour <- format(hourly_steps$ActivityDatetime, format = "%H")
str(hourly_steps)
```
### Hourly Intensities
```{r clean hourly_intensities}
# convert ActivityHour column into datetime and create new column "ActivityDatime" with result
hourly_intensities$ActivityDatetime <- as.POSIXct(hourly_intensities$ActivityHour, format="%m/%d/%Y %I:%M:%S %p")
# extract hour from ActivityDatetime and create new column "Hour" with result
hourly_intensities$Hour <- format(hourly_intensities$ActivityDatetime, format = "%H")
str(hourly_intensities)
```
## Merging Data
### Hourly Steps, Intensities & Calories
```{r compare hourly_steps, hourly_calories, hourly_intensities}
n_distinct(hourly_steps$Id)
n_distinct(hourly_calories$Id)
n_distinct(hourly_intensities$Id)
```
```{r merging hourly steps, calories, intensities}
# merge hourly_steps and hourly_calories
hourly_sc <- merge(hourly_steps, hourly_calories, by=c("Id", "ActivityDatetime", "ActivityHour", "Hour"))
# merge with hourly_intensities
hourly_sci <- merge(hourly_sc, hourly_intensities, by=c("Id", "ActivityDatetime", "ActivityHour", "Hour"))
# drop "ActivityHour"
hourly_sci <- subset(hourly_sci, select = -c(ActivityHour))
summary(hourly_sci)
```

### Daily Activities & Sleep
```{r comapre sleep_day and daily_activities}
n_distinct(sleep_day$Id)
n_distinct(daily_activity$Id)
nrow(sleep_day)
nrow(daily_activity)
```

```{r merging daily steps and hours asleep}

```

# Step 4: Analyze
## Pivot Tables
### Hourly Activities
```{r compute average hourly steps, calories and intensities for each user}
# each user's hourly activities
hourly_user <- hourly_sci %>%
  group_by(Id, Hour) %>%
  summarize(average_steps = mean(StepTotal), average_intensities = mean(TotalIntensity), average_calories = mean(Calories))
```
```{r compute hourly activities}
# hourly activity distribution
hourly_general <- hourly_user %>%
  group_by(Hour) %>%
  summarize(average_steps = mean(average_steps), average_intensities = mean(average_intensities), average_calories = mean(average_calories))
```


### Sleep
```{r sleep_day pivot table}
# each user's sleep pattern
sleep_day_pu <- sleep_day %>%
  group_by(Id) %>%
  summarize(entries = n(), average_InBed = mean(TotalTimeInBed), average_Asleep = mean(TotalMinutesAsleep))
# get number of hours each user sleep for per day
sleep_day_pu$hoursAsleep = sleep_day_pu$average_Asleep / 60
sleep_day_pu$hoursInBed = sleep_day_pu$average_InBed / 60
# get insight into each user's sleep activity
sleep_day_pu %>%
  select(hoursAsleep, hoursInBed) %>%
  summary()
```

## Visualization
### Sleep Patterns
#### Average number of hours asleep per day for each user
```{r plot hours asleep for each user}
# convert Id to character
sleep_day_pu$Id <- as.character(sleep_day_pu$Id)
sleep_day_pu$Id <- strtrim(sleep_day_pu$Id, 3)
ggplot(sleep_day_pu, aes(x = Id, y = hoursAsleep)) +
  geom_bar(stat = "identity") +
  labs(title = "Average Hours of Daily Sleep for Users")
```

##### We can observe that some users are not getting enough hours of sleep which is 7-9 hours for adults as recommended by WHO.

### Hourly activities for all users
#### Avergae Steps
```{r average_steps vs Hour}
ggplot(hourly_general, aes(x=Hour, y=average_steps)) +
  geom_bar(stat = "identity") +
  labs(title="Average Steps vs Hour of the day")
```
#### Average Instensities
```{r average_intensities vs Hour}
ggplot(hourly_general, aes(x=Hour, y=average_intensities)) +
  geom_bar(stat = "identity") +
  labs(title = "Average Intensities vs Hour of the day")
```
#### Average Calories
```{r average_calories vs Hour}
ggplot(hourly_general, aes(x=Hour, y=average_calories)) +
  geom_bar(stat = "identity") +
  labs(title = "Average Calories vs Hour of the day")
```

##### These graphs show us the hours when users are most active. FitBit can leverage this isnsight and send psuh notifications to users to remind and encourage them about workout (go for a walk or run) during these hours. Peak activity is observed between *5pm and 7pm.*

# Step 5: Share
## Recommendations for FitBit
* Push notifications should be sent to users between 5 pm and 7 pm to remind them to exercise as they generally more active during these hours.
* Users with less than 7 hours average sleep time should be encouraged to go to bed earlier so they can get more sleep.
